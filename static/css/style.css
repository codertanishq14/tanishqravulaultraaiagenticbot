/* static/css/style.css (Completely Revamped UI) */

:root {
    --bg-primary: #1e1e24;       /* Dark background */
    --bg-secondary: rgba(38, 38, 44, 0.75); /* Translucent sidebar */
    --bg-tertiary: #2a2a32;      /* Input/hover areas */
    --glass-blur: backdrop-filter(blur(20px)) saturate(180%);
    --text-primary: #e0e0e0;     /* Light main text */
    --text-secondary: #9a9a9a;   /* Grey secondary text */
    --accent-color: #00aaff;     /* Bright blue accent */
    --border-color: rgba(255, 255, 255, 0.1); /* Subtle borders */
    --user-msg-bg: #007acc;      /* Vibrant blue for user */
    --bot-msg-bg: #2d2d37;       /* Dark grey for bot */
    --code-bg: #16161a;          /* Very dark for code blocks */
}

/* General Reset & Body */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

/* --- CORE FIX FOR MOBILE KEYBOARD ISSUE --- */
/* By setting html and body height to 100%, we create a layout container
   that correctly resizes when the mobile keyboard appears. */
html, body {
    height: 100%;
}

body {
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-primary);
    background-image: radial-gradient(circle at 1px 1px, rgba(255, 255, 255, 0.05) 1px, transparent 0);
    background-size: 25px 25px;
    color: var(--text-primary);
    /* This is important: it prevents the entire page from scrolling,
       allowing only our message container to scroll. */
    overflow: hidden;
}

.chat-container {
    display: flex;
    /* --- CORE FIX FOR MOBILE KEYBOARD ISSUE --- */
    /* Changed from `height: 100vh` to `height: 100%`.
       `100vh` does not account for the keyboard, pushing the input off-screen.
       `100%` respects the actual visible space, keeping the input box in view. */
    height: 100%;
}

/* --- Sidebar --- */
.sidebar {
    width: 260px;
    background-color: var(--bg-secondary);
    -webkit-backdrop-filter: var(--glass-blur);
    backdrop-filter: var(--glass-blur);
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--border-color);
    flex-shrink: 0;
    transition: transform 0.3s ease-in-out;
}

.sidebar-header {
    padding: 1.25rem;
    border-bottom: 1px solid var(--border-color);
}

.sidebar-button {
    width: 100%;
    padding: 0.75rem 1rem;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 500;
    text-align: left;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
}

.sidebar-button:hover {
    background-color: var(--accent-color);
    border-color: var(--accent-color);
    color: #fff;
}

.sidebar-button i {
    margin-right: 0.75rem;
}

.chat-history {
    flex-grow: 1;
    overflow-y: auto;
    padding: 0.5rem;
}
.chat-history::-webkit-scrollbar { width: 4px; }
.chat-history::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }


#chat-history-list {
    list-style: none;
}

#chat-history-list li {
    padding: 0.75rem 1rem;
    margin-bottom: 0.25rem;
    cursor: pointer;
    border-radius: 6px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 0.9rem;
    color: var(--text-secondary);
    transition: background-color 0.2s, color 0.2s;
}

#chat-history-list li:hover {
    background-color: var(--bg-tertiary);
    color: var(--text-primary);
}

#chat-history-list li.active {
    background-color: var(--accent-color);
    color: #ffffff;
    font-weight: 500;
}

.sidebar-footer {
    padding: 1rem;
    font-size: 0.8rem;
    color: var(--text-secondary);
    text-align: center;
    border-top: 1px solid var(--border-color);
}

/* --- Main Chat Window --- */
.chat-window {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    background-color: transparent;
    min-width: 0;
}

.message-container {
    flex-grow: 1;
    overflow-y: auto;
    padding: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    /* --- FIX: Constrain width and center chat on desktop for readability --- */
    max-width: 900px;
    width: 100%;
    margin: 0 auto;
}
.message-container::-webkit-scrollbar { width: 6px; }
.message-container::-webkit-scrollbar-thumb { background: #444; border-radius: 6px; }


/* --- Welcome Screen --- */
.welcome-screen {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    height: 100%;
    margin: auto;
}
.welcome-screen .logo {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--accent-color);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 1rem;
}
.welcome-screen h1 {
    font-size: 2rem;
    margin-bottom: 2rem;
    color: #fff;
}
.example-prompts {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    width: 100%;
    max-width: 600px;
}
.prompt-card {
    background: var(--bg-tertiary);
    padding: 1rem;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.prompt-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}
.prompt-card h4 {
    font-size: 1rem;
    margin-bottom: 0.25rem;
}
.prompt-card p {
    font-size: 0.9rem;
    color: var(--text-secondary);
}


/* --- Input Area --- */
.input-area {
    padding: 1rem 2rem;
    flex-shrink: 0;
    background-color: transparent;
}
.chat-form {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.input-wrapper {
    position: relative;
    display: flex;
    width: 100%;
    background-color: var(--bg-tertiary);
    border-radius: 12px;
    padding: 0.25rem;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: border-color 0.2s ease;
}
.input-wrapper:focus-within {
    border-color: var(--accent-color);
}
textarea#prompt-input {
    flex-grow: 1;
    background: none;
    border: none;
    outline: none;
    color: var(--text-primary);
    font-size: 1rem;
    padding: 0.75rem;
    resize: none;
    max-height: 200px;
    overflow-y: auto;
}
textarea#prompt-input::placeholder {
    color: var(--text-secondary);
}
.icon-button {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0.75rem;
    border-radius: 8px;
    transition: color 0.2s, background-color 0.2s;
}
.icon-button:hover {
    color: var(--text-primary);
    background-color: rgba(255, 255, 255, 0.1);
}
.send-btn {
    color: var(--accent-color);
}
.send-btn:hover {
    color: #fff;
    background-color: var(--accent-color);
}
.attachment-preview {
    margin-bottom: 0.5rem; padding: 0.5rem; background-color: var(--bg-tertiary); border-radius: 6px; display: none; align-items: center; gap: 0.5rem; font-size: 0.9rem;
}
.attachment-preview i { color: var(--accent-color); }
#remove-attachment-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; margin-left: auto; }

/* --- Messages --- */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.message {
    max-width: 80%;
    display: flex;
    gap: 1rem;
    animation: fadeIn 0.4s ease-out;
}

.message .message-content {
    padding: 0.8rem 1.2rem;
    border-radius: 18px;
    line-height: 1.6;
    overflow-wrap: break-word;
    word-break: break-word;
    border: 1px solid var(--border-color);
}

.user-message {
    align-self: flex-end;
    flex-direction: row-reverse;
}
.user-message .message-content {
    background-color: var(--user-msg-bg);
    color: white;
    border: none;
    border-bottom-right-radius: 4px;
}

.bot-message {
    align-self: flex-start;
}
.bot-message .message-content {
    background-color: var(--bot-msg-bg);
    border-bottom-left-radius: 4px;
}

.typing-cursor { display: inline-block; width: 8px; height: 1.2em; background-color: var(--text-primary); animation: blink 1s infinite; vertical-align: text-bottom; margin-left: 2px; }
@keyframes blink { 50% { opacity: 0; } }

/* --- Code and Tables --- */
.bot-message pre {
    background-color: var(--code-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem;
    padding-top: 2.5rem;
    margin: 1em 0;
    position: relative;
    overflow-x: auto;
}
.bot-message code {
    font-family: 'Courier New', Courier, monospace;
    font-size: 0.9rem;
    white-space: pre;
}
.code-header { position: absolute; top: 0; left: 0; right: 0; display: flex; justify-content: flex-end; align-items: center; background-color: #2a2a32; padding: 0.25rem 0.5rem; border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom: 1px solid var(--border-color); }
.copy-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 0.3rem; transition: color 0.2s; }
.copy-btn:hover { color: var(--text-primary); }

.bot-message table {
    margin: 1em 0; display: block; overflow-x: auto; border: 1px solid var(--border-color); border-radius: 8px; width: 100%; border-collapse: collapse;
}
.bot-message th, .bot-message td {
    padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid var(--border-color);
}
.bot-message th { background-color: #2a2a32; font-weight: 500; }
.bot-message tr:last-child td { border-bottom: none; }

/* --- Mobile Responsive Styles --- */
.mobile-header { display: none; padding: 0.5rem 1rem; border-bottom: 1px solid var(--border-color); background-color: var(--bg-secondary); }
.mobile-title { font-size: 1.2rem; color: #fff; }
#sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 999; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
#sidebar-overlay.active { opacity: 1; visibility: visible; }

@media (max-width: 768px) {
    .chat-container { flex-direction: column; }
    .mobile-header { display: flex; align-items: center; gap: 1rem; }
    .sidebar { position: fixed; left: 0; top: 0; height: 100%; z-index: 1000; transform: translateX(-100%); box-shadow: 2px 0 10px rgba(0,0,0,0.2); }
    .sidebar.show { transform: translateX(0); }

    /* The original "FIX" below was correct in spirit but didn't work because
       the parent container was still using 100vh. Now that the parent is fixed,
       this rule will work as intended. */
    .chat-window {
        width: 100%;
        height: 100%;
    }

    .message-container {
        padding: 1rem;
        max-width: 100%;
    }

    .input-area {
        padding: 0.5rem 1rem;
        padding-bottom: calc(0.5rem + env(safe-area-inset-bottom));
    }

    .message { max-width: 95%; }
    .welcome-screen h1 { font-size: 1.5rem; }
    .example-prompts { grid-template-columns: 1fr; }
}
